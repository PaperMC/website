---
import { Icon } from "astro-icon/components";

export enum SoftwarePreviewType {
  Info = "Info",
  Download = "Download",
  Javadocs = "Javadocs",
}

interface Props {
  id: string;
  name: string;
  icon: any;
  description?: string;
  type: SoftwarePreviewType;
  eol?: boolean;
}

const { id, name, icon, description, type, eol } = Astro.props;
---

<software-preview data-software={id} data-preview-type={type}>
  <a href="#loading">
    <article class="rounded-xl transition-all h-full p-4 md:p-8 hover:(shadow-lg bg-primary-300 dark:bg-gray-800)">
      <div class="flex flex-row items-center gap-4">
        <div class="rounded-lg w-12 h-12 bg-gray-800 p-3">
          <Icon name={icon} class="w-full h-full" />
        </div>
        <h3 class="font-medium flex-1 flex gap-4 items-center">
          {name}
          {eol && <Icon name="icons/fontawesome/box-archive" class="size-6" />}
        </h3>
      </div>

      {description && <p class="text-gray-800 dark:text-gray-200 mt-4">{description}</p>}
    </article>
  </a>
</software-preview>

<script>
  import { fetchProject } from "@/utils/api";

  class SoftwarePreview extends HTMLElement {
    async connectedCallback() {
      const { software, previewType } = this.dataset;
      if (!software || !previewType) {
        return;
      }

      const anchor = this.querySelector("a");
      if (!anchor) {
        return;
      }

      switch (previewType) {
        case "Info":
          anchor.href = `/software/${software}`;
          break;
        case "Download":
          anchor.href = `/downloads/${software}`;
          break;
        case "Javadocs":
          const { version_groups } = await fetchProject(software);
          anchor.href = `https://jd.papermc.io/${software}/${version_groups[version_groups.length - 1]}`;
          break;
      }
    }
  }

  customElements.define("software-preview", SoftwarePreview);
</script>
