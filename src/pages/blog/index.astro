---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";
import { formatDateLong } from "@/utils/time";
import { countWords, minutesToRead } from "@/utils/content";
import { Icon } from "astro-icon/components";

const posts = (await getCollection("posts")).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const postsWithMeta = posts.map((p) => {
  const words = countWords(p.body ?? "");
  return {
    ...p,
    words,
    mins: minutesToRead(words),
  };
});

const latest = postsWithMeta[0];
---

<Layout title="Blog" description="" keywords={[]} canonical="/blog">
  <div class="container mx-auto mt-10 max-w-4xl px-4 py-12">
    <div class="flex flex-col gap-4">
      {
        postsWithMeta.map((entry) => (
          <a href={`/blog/${entry.id}`} class="group">
            <div class="flex flex-col gap-6 rounded-xl border py-6 shadow-sm transition-all duration-200 hover:border-[#006911]/50 hover:bg-[#006911]/5">
              <div class="flex flex-col gap-4 p-6 sm:flex-row sm:items-start">
                <div class="flex-1 space-y-3">
                  <div class="flex items-start justify-between gap-4">
                    <h2 class="text-foreground group-hover:text-primary text-xl leading-tight font-bold text-balance">
                      {entry.data.title}
                    </h2>
                  </div>
                  <p class="text-muted-foreground text-sm leading-relaxed">{entry.data.description}</p>
                  <div class="text-muted-foreground flex flex-wrap items-center gap-x-4 gap-y-2 text-xs">
                    <div class="flex items-center gap-1.5">
                      <Icon name="icons/lucide/calendar" class="size-3.5" />
                      <span>{formatDateLong(new Date(entry.data.date))}</span>
                    </div>
                    <div class="flex items-center gap-1.5">
                      <Icon name="icons/lucide/clock" class="size-3.5" />
                      <span>{entry.mins} min read</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </a>
        ))
      }
    </div>
  </div>
</Layout>
