---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";
import { formatDateLong } from "@/utils/time";
import { countWords, minutesToRead } from "@/utils/content";
import { Icon } from "astro-icon/components";

const posts = (await getCollection("posts")).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const postsWithMeta = posts.map((p) => {
  const words = countWords(p.body ?? "");
  const excerpt = (p.body ?? "")
    .replace(/[#>*`\n]/g, " ")
    .trim()
    .slice(0, 512);
  return {
    ...p,
    words,
    mins: minutesToRead(words),
    excerpt,
  };
});
---

<Layout title="Blog" description="" keywords={[]} canonical="/blog">
  <div class="container mx-auto mt-10 max-w-4xl px-4 py-12">
    <div class="flex flex-col gap-4">
      {
        postsWithMeta.map((entry) => (
          <a href={`/blog/${entry.id}`} class="group">
            <div class="flex flex-col gap-6 rounded-xl border py-6 shadow-sm transition-all duration-200 hover:border-[#006911]/50 hover:bg-[#006911]/5">
              <div class="flex flex-col gap-3 p-6">
                <h2 class="text-foreground group-hover:text-primary text-xl leading-tight font-bold text-balance">{entry.data.title}</h2>

                <div class="text-muted-foreground text-xs">
                  <div class="flex flex-row flex-wrap items-baseline gap-x-3 gap-y-1">
                    <span class="inline-flex items-baseline gap-1.5">
                      <Icon name="icons/lucide/calendar" class="size-[14px] translate-y-[1px]" />
                      <span>{formatDateLong(new Date(entry.data.date))}</span>
                    </span>

                    <span aria-hidden="true">Â·</span>

                    <span class="inline-flex items-baseline gap-1.5">
                      <Icon name="icons/lucide/clock" class="size-[14px] translate-y-[1px]" />
                      <span>{entry.mins} min read</span>
                    </span>
                  </div>
                </div>

                <p class="text-muted-foreground mask-fade-bottom max-h-28 overflow-hidden text-sm leading-relaxed [--fade-size:2.5rem]">
                  {entry.excerpt}
                </p>
              </div>
            </div>
          </a>
        ))
      }
    </div>
  </div>
</Layout>
